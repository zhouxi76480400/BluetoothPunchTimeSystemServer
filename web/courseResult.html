<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Courses Management</title>
    <link rel="stylesheet" href="css/amazeui.min.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style type="text/css">
        .table>tbody>tr>th{
            vertical-align:middle;
            /*text-align: center;*/
        }
        .table>tbody>tr>td{
            vertical-align:middle;
            /*text-align: center;*/
        }
        #studentPage{
            width: 50%;
            margin: 0 auto;
        }
    </style>
</head>
<body>

<div id="coursepage" class="admin-content-body" style="display: block">
    <div class="am-cf am-padding am-padding-bottom-0">
        <div class="am-fl am-cf">
            <strong class="am-text-primary am-text-lg">Courses List</strong>
        </div>
    </div>

    <hr>

    <ul id="courses" class="am-avg-sm-2 am-avg-md-4 am-avg-lg-6 am-margin gallery-list">
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="courseResult.html">
                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <!--<img class="am-img-thumbnail am-img-bdrs" src="images/" alt="">-->

                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <!--<img class="am-img-thumbnail am-img-bdrs" src="images/" alt="">-->

                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <!--<img class="am-img-thumbnail am-img-bdrs" src="images/" alt="">-->

                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <!--<img class="am-img-thumbnail am-img-bdrs" src="images/" alt="">-->

                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <!--<img class="am-img-thumbnail am-img-bdrs" src="images/" alt="">-->

                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
        <li class="courseli" data-toggle="modal" data-target="#myModal1">
            <a href="#">
                <div class="courseName">計算機システム特論</div>
                <div class="courseTime">2019/5/28</div>
            </a>
        </li>
    </ul>

</div>

<div id="result" class="admin-content-body" style="display: none">
    <div class="am-cf am-padding am-padding-bottom-0">
        <div class="am-fl am-cf">
            <strong class="am-text-primary am-text-lg">Attendance results</strong>
        </div>
    </div>

    <hr>
    <div class="bs-example" data-example-id="hoverable-table">
        <div id="teacherPage" style="display: none">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Student ID</th>
                    <th>Result</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223
                    <td>8:40</td>
                    <td>9:40</td>
                    <td>10:40</td>
                    <td>11:40</td>
                    <td>Attend</td>
                </tr>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223</td>
                    <td>8:40</td>
                    <td>9:40</td>
                    <td>10:40</td>
                    <td>11:40</td>
                    <td>Absence</td>
                </tr>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223</td>
                    <td>8:40</td>
                    <td>9:40</td>
                    <td>10:40</td>
                    <td>11:40</td>
                    <td>Absence</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div id="studentPage" class="row" style="display: none;">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Last Name</th>
                    <th>Student ID</th>
                    <th>Result</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223</td>
                    <td>Attend</td>
                </tr>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223</td>
                    <td>Attend</td>
                </tr>
                <tr>
                    <th scope="row">AMIN</th>
                    <td>19556223</td>
                    <td>Attend</td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>


</div>

</body>
<script src="js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(function () {
        $.ajax({
            crossDomain: true,
            url:'http://192.168.1.43:8080/s/gs?c=30',
            // data:senddata,
            type: "POST",
            dataType: "json",
            // contentType: "json",
            xhrFields:{},
            async:false,
            success:function(data){
                console.log(data);
                $("#courses").html("");
                for( var i=0;i<data.data.length; i++){
                    $("#courses").html( $("#courses").html() + "<li class='courseli' data-toggle='modal' data-target='#myModal' id="+data.data[i].sort_id+">\n" +
                        "<a href='#'>\n" +
                        "<div class='courseName'>"+data.data[i].name+"</div>\n" +
                        "<div class='courseTime'>"+ (new Date(data.data[i].create_time/1000 * 1000)).toLocaleString()+"</div>\n" +
                        "</a>\n" + "</li>"
                    )
                }
            }
        });

        $("#courses").on('click','.courseli',function(){
            var sendid = this.getAttribute('id');
            // console.log(sendid);
            $('#coursepage').hide();
            $('#result').show();
            function getCookie(userName) {
                var arr, reg = new RegExp("(^| )" + userName + "=([^;]*)(;|$)");
                if (arr = document.cookie.match(reg))
                    return unescape(arr[2]);
                else
                    return null;
            }
            var userNameValue = getCookie("userName");
            console.log(userNameValue)
            if (userNameValue === '' || userNameValue === null){
                alert(1)
                $('#studentPage').show();
                $('#teacherPage').hide();
                request(true,sendid);
                // student(sendid);
            }else{
                $('#studentPage').hide();
                $('#teacherPage').show();
                request(false,sendid);
                // teacher(sendid);
            }
        });

        // function teacher(sendid) {
        //     $.ajax({
        //         crossDomain: true,
        //         url:'gi?',
        //         type: "POST",
        //         data:"id="+sendid,
        //         dataType: "json",
        //         xhrFields:{},
        //         success:function(data){
        //             console.log(data);
        //             var aqiArray=[];
        //             $("#teacherPage>table>tbody").html('');
        //             for(var i=0;i<data.l.length;i++){
        //                 aqiArray.push(data.l[i]);
        //                 console.log(aqiArray);
        //                 // header(aqiArray);
        //                 /*  for (var j=0;j<data.l[i].data.length;j++){
        //                       $("#teacherPage>table>tbody").html( $("#teacherPage>table>tbody").html() +' <tr>\n' +
        //                           '<th scope="row">'+data.l[i].data[j].first_name+''+data.l[i].data[j].last_name+'</th>\n' +
        //                           '<td>'+data.l[i].data[j].student_number+'</td>\n' +
        //                           '<td>'+(new Date(data.l[0].create_time/1000 * 1000)).toLocaleString()+'</td>\n' +
        //                           '<td>'+(new Date(data.l[1].create_time/1000 * 1000)).toLocaleString()+'</td>\n' +
        //                           '<td>'+(new Date(data.l[1].create_time/1000 * 1000)).toLocaleString()+'</td>\n' +
        //                           '<td>'+(new Date(data.l.pop().create_time/1000 * 1000)).toLocaleString()+'</td>\n' +
        //                           '<td>Attend</td>\n' +
        //                           '</tr>')
        //                   }*/
        //
        //                 /*  function header(aqiArray) {
        //                       for (var i=0;i<aqiArray.length;i++){
        //                           var header = $("#teacherPage>table>thead").html($("#teacherPage>table>thead").html() +'' +
        //                               '<th>The '+ i +' record</th>\n' +
        //                               '<th>Result</th>\n');
        //                           $("#teacherPage>table>thead").appendChild(header);
        //                       }*/
        //
        //                 // }
        //             }
        //
        //         }
        //     });
        // }
        //
        // function student(sendid) {
        //     $.ajax({
        //         crossDomain: true,
        //         url:'gi?',
        //         type: "POST",
        //         data:"id="+sendid,
        //         dataType: "json",
        //         // contentType: "json",
        //         xhrFields:{},
        //         success:function(data){
        //             console.log(data);
        //
        //             // $("#teacherPage>table>tbody").html('');
        //             // for(var i=0;i<data.l.length;i++){
        //             //     for (var j=0;j<data.l[i].data.length;j++){
        //             //         $("#studentPage>table>tbody").html(' <tr>\n' +
        //             //             '<th scope="row">'+data.l[i].data[j].last_name+'</th>\n' +
        //             //             '<td>'+data.l[i].data[j].student_number+'</td>\n' +
        //             //             '<td>Attend</td>\n' +
        //             //             '</tr>')
        //             //     }
        //             // }
        //
        //         }
        //     });
        // }

        function request(isStudent,sendid) {
            $.ajax({
                crossDomain: true,
                url:'http://192.168.1.43:8080/s/gi?',
                type: "POST",
                data:"id="+sendid,
                dataType: "json",
                // contentType: "json",
                xhrFields:{},
                success:function(data){
                    createData(isStudent,data)
                }
            });
        }


        function createData(isStudent,data) {
            var data_array = data.l;
            //打卡次數
            var frequency = data_array.length;//次數
            //所有來的同學
            var student_map = {};//所有來的人的詳細信息
            //所有次數的時間
            var all_times_date = [];
            //學生id和已經計算好的數據map
            var student_id_and_checked_data_map = {};//結果
            //遍歷
            for(var i = 0 ; i < frequency ; i ++) {
                // 每一次的數據
                var times_data = data_array[i];
                // 拿時間
                time = times_data;
                all_times_date.push(time);
                //所有人
                var all_people = times_data.data;
                for (var j = 0 ; j < all_people.length ; j ++) {
                    var people = all_people[j];
                    var student_id = people.id;
                    student_map[student_id] = people;
                    //計算好的數據map
                    //從map取出list
                    checked_list = student_id_and_checked_data_map[student_id];
                    //如果沒有定義 給他定義個
                    if(checked_list == null) {
                        checked_list = [];
                    }
                    //把時間存入
                    checked_list.push(time);
                    //把他存回去
                    student_id_and_checked_data_map[student_id] = checked_list;
                    studentpage(student_map);
                }
            }

            // ["id":111,"result":[true,true,false]];
            console.log(student_map);
            function  studentpage(student_map){
                // $("#studentPage>table>tbody").html('');
                // for(var i=0;i<data.l.length;i++){
                //     for (var j=0;j<data.l[i].data.length;j++){
                //         $("#studentPage>table>tbody").html(' <tr>\n' +
                //             '<th scope="row">'+data.l[i].data[j].last_name+'</th>\n' +
                //             '<td>'+data.l[i].data[j].student_number+'</td>\n' +
                //             '<td>Attend</td>\n' +
                //             '</tr>')
                //     }
                // }
            }





        }

        // function checkResult(id,all_times_date,student_id_and_checked_data_map) {
        //
        //
        //     return [];
        // }

    });

</script>
</html>
